<div class="message" [ngClass]="{'current-user': (user.id == currentUserID)}">
    <img class="avatar" src="{{ user.avatar }}" alt="" (click)="openShowUserDialog(user)" />

    <!-- Message Info / Edit -->
    <div class="details">
        @if (!isEditMsg) {  <!-- Message Info Part -->
        <div class="name-timestamp">
            <h3 (click)="openShowUserDialog(user)">{{ user.name }}</h3>
            <span>{{ setTime(msg.date) }} Uhr</span>
        </div>
        <mat-card class="message-card">
            <mat-card-content>{{ msg.message }}</mat-card-content>
        </mat-card>
        <!-- Replay Part -->
        @if(isChannelMsg && replaies.length > 0){
        <div class="reply">
            <a (click)="setThreadOutput()">{{ replaies.length }} Antworten</a>
            <span>Letzte Antwort {{ setTime(replaies[replaies.length-1].date) }}</span>
        </div>
        }
        <!-- Emoji Reaction Part -->
        @if(sortedLikes.length > 0){
        <div #likesRow class="likes-row" (mousemove)="setHiddenLikePos()">
            <mat-icon class="action-btn" (click)="openDialogEmoji()">add_reaction</mat-icon>
            @for (like of sortedLikes; track $index) {
            <div class="sorted-like">
                <div class="emoji">
                    @if(like.usersIDs.length > 1){ <div>{{ like.emoji }}</div> <span>{{ like.usersIDs.length }}</span> }
                    @else {  <div>{{ like.emoji }}</div>  }
                </div>
                <div class="hidden-like" [style.bottom.px]="posLikesRow">
                    <div>{{ like.emoji }}</div>
                    @for (nameID of sortedLikes[$index].usersIDs; track $index) {
                    <a>{{ data.getUserNameById(nameID) }}</a>
                    }
                    @if (sortedLikes[$index].usersIDs.length > 1) {
                    <span>haben reagiert</span>
                    }@else { <span>hat reagiert</span> }
                </div>
            </div>
            }
        </div>
        }

        }
        @else {             <!-- Message Edit Part -->
        <div class="edit">
            <textarea #msgText class="edit-text" cols="30" rows="3" (input)="checkChange()">{{ msg.message }}</textarea>
            <div class="edit-bottom">
                <mat-icon class="action-btn" #emoijBtn (click)="openDialogEmoji()">add_reaction</mat-icon>
                <div class="btn-area">
                    <button class="icon-btn delet-btn" mat-fab extended color="primary" (click)="deletMsg()">
                        <mat-icon>delete</mat-icon>
                    </button>
                    <button class="icon-btn safe-btn" mat-fab extended color="primary" (click)="saveMsg()"
                        [ngClass]="{'btn-disable': !isSaveEnable}">
                        <mat-icon>save</mat-icon>
                    </button>
                </div>
            </div>
            <button class="icon-btn cancle-btn pos-abso-right-top" mat-fab extended color="primary"
                (click)="toggleEditMsg()">
                <mat-icon>close</mat-icon>
            </button>
        </div>
        }

    </div>

    <!-- Slidin Emoji options -->
    @if(!isEditMsg){
    <mat-card class="emoji-popup">
        <mat-card-content>
            @if (isChannelMsg) {
            <mat-icon class="action-btn" (click)="openDialogEmoji()">add_reaction</mat-icon>
            <mat-icon class="action-btn" (click)="setThreadOutput()">comment</mat-icon>
            @if (editPossible()){
            <mat-icon class="action-btn" (click)="toggleEditMsg()">more_vert</mat-icon>
            }
            } @else {
            <mat-icon class="action-btn" (click)="openDialogEmoji()">add_reaction</mat-icon>
            @if (editPossible()){
            <mat-icon class="action-btn" (click)="toggleEditMsg()">more_vert</mat-icon>
            }
            }
        </mat-card-content>
    </mat-card>
    }
</div>